<?xml version="1.0" ?>

<!-- Base elements for Discrete Events System layer. 
     -->

<!DOCTYPE node SYSTEM "/usr/share/grayb/conf/objspec.dtd"> 

<node id="DesComps" parent="Elem">

    <!-- Module containing components of system layer -->
    <node id="sysmod" parent="file:/usr/share/grayb/modules/syst.xml#SysComps" />
    <!-- Module containing components of incaps layer -->
    <node id="incapsmod" parent="file:/usr/share/grayb/modules/capsula.xml#IncapsComps" />
    <!-- Module containing components of data -->
    <node id="datamod" parent="file:/usr/share/grayb/modules/data.xml#DataComps" />

    <!-- DES logging event -->
    <node id="DesLogevent" parent="Elem" />
    
    <!-- Output socket -->
    <node id="StOutSocket" parent="SysComps:sysmod/Vert:Socket">
	<!-- Pin Des observer. Requires DES observer interface to handle activation of the state -->
	<node id="PinObs" parent="../SysComps:sysmod/ConnPointBase:ConnPoint"> 
	    <cont node="Prop:Provided" val="MDesObserver"/>
	</node>
	<!-- Pin Data observer. Provides data interface -->
	<node id="PinData" parent="../SysComps:sysmod/ConnPointBase:ConnPoint"> 
	</node>
    </node>

    <!-- Input socket -->
    <node id="StInpSocket" parent="SysComps:sysmod/Vert:Socket">
	<!-- Pin Des observer. Requires DES observer interface to handle activation of the state -->
	<node id="PinObs" parent="../SysComps:sysmod/ConnPointBase:ConnPoint"> 
	    <cont node="Prop:Required" val="MDesObserver"/>
	</node>
	<!-- Pin Data observer. Provides data interface -->
	<node id="PinData" parent="../SysComps:sysmod/ConnPointBase:ConnPoint"> 
	</node>
    </node>

    <!-- Input of standard Int State -->
    <node id="StIntInp" parent="SysComps:sysmod/Vert:Extender"> 
	<rm node="ConnPoint:Int"/>
	<node id="Int" parent="../Socket:StInpSocket"> 
	    <cont node="ConnPoint:PinData/Prop:Provided" val="MDIntGet"/>
	</node>
    </node>

    <!-- Output of standard Int State -->
    <node id="StIntOut" parent="SysComps:sysmod/Vert:Extender"> 
	<rm node="ConnPoint:Int"/>
	<node id="Int" parent="../Socket:StOutSocket"> 
	    <cont node="ConnPoint:PinData/Prop:Required" val="MDIntGet"/>
	</node>
    </node>

    <!-- Transition of integer data -->
    <node id="TrInt" parent="Syst"> 
	<node id="Inp" parent="../SysComps:sysmod/ConnPointBase:ConnPoint"> 
	    <cont node="Prop:Required" val="MDIntGet"/>
	</node>
	<node id="Out" parent="../SysComps:sysmod/ConnPointBase:ConnPoint"> 
	    <cont node="Prop:Provided" val="MDIntGet"/>
	</node>
    </node>

    <!-- Transition of integer data : Increment -->
    <node id="TrIncInt" parent="Syst:TrInt"> 
	<add node="Elem:Agents"> 
	    <node id="TrAgt" parent="ATrIncInt"> 
	    </node>
	</add>
    </node>

    <!-- State base -->
    <node id="State" parent="IncapsComps:incapsmod/Syst:Incaps"> 

	<add node="Elem:Agents"> 
	    <node id="StateAgt" parent="StateAgent"> 
	    </node>
	</add>

	<add node="Elem:Capsule">
	    <!-- TODO [YB] Do we need dedicated CP or component has to notify it's mgr? -->
	    <node id="Sync" parent="../../SysComps:sysmod/ConnPointBase:ConnPoint"> 
		<cont node="Prop:Provided" val="MDesSyncable"/>
	    </node>
	    <!-- Input -->
	    <node id="Inp" parent="../../SysComps:sysmod/Vert:Extender"> 
		<rm node="ConnPoint:Int"/>
		<node id="Int" parent="../../../Socket:StInpSocket"> 
		</node>
	    </node>
	    <!-- Output -->
	    <node id="Out" parent="../../SysComps:sysmod/Vert:Extender"> 
		<rm node="ConnPoint:Int"/>
		<node id="Int" parent="../../../Socket:StOutSocket"> 
		</node>
	    </node>
	</add>
    </node>

    <node id="StateInt" parent="Incaps:State"> 
	<node id="Confirmed" parent="../DataComps:datamod/DataSC:DataSCInt">
	</node>

	<node id="Prepared" parent="../DataComps:datamod/DataSC:DataSCInt">
	</node>

	<cont node="Elem:Capsule/Extender:Inp/StInpSocket:Int/ConnPoint:PinData/Prop:Provided" val="MDIntGet"/>
	<cont node="Elem:Capsule/Extender:Out/StOutSocket:Int/ConnPoint:PinData/Prop:Required" val="MDIntGet"/>

	<node parent="Edge"> 
	    <cont node="Prop:P1" val="DataSCInt:Confirmed/Elem:Capsule/ConnPoint:Out"/> 
	    <cont node="Prop:P2" val="Elem:Capsule/Extender:Out/StOutSocket:Int/ConnPoint:PinData"/> 
	</node>

	<node parent="Edge"> 
	    <cont node="Prop:P1" val="DataSCInt:Prepared/Elem:Capsule/ConnPoint:Out"/> 
	    <cont node="Prop:P2" val="DataSCInt:Confirmed/Elem:Capsule/ConnPoint:Inp"/> 
	</node>
    </node>

    <!-- DES base -->
    <node id="Des" parent="IncapsComps:incapsmod/Syst:Incaps"> 

	<add node="Elem:Agents"> 
	    <node id="DesAgt" parent="ADes"> 
	    </node>
	</add>

	<add node="Elem:Capsule">
	    <node id="Sync" parent="../../SysComps:sysmod/ConnPointBase:ConnPoint"> 
		<cont node="Prop:Provided" val="MDesSyncable"/>
	    </node>
	</add>
    </node>

    <!-- DES ticks source -->
    <node id="DesTicker" parent="IncapsComps:incapsmod/Syst:Incaps"> 
	<add node="Elem:Capsule">
	    <node id="Out" parent="../../sysmod/ConnPoint"> 
		<cont node="Required" val="MDesSyncable"/>
	    </node>
	</add>
	<add node="Elem:Agents"> 
	    <node id="DesSyncAgent" parent="ADesSync"> 
	    </node>
	</add>
    </node>


</node>

